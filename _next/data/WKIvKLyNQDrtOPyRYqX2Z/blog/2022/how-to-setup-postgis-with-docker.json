{"pageProps":{"post":{"mdxSource":"var Component=(()=>{var r=Object.create;var l=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var h=Object.getPrototypeOf,m=Object.prototype.hasOwnProperty;var i=a=>l(a,\"__esModule\",{value:!0});var u=(a,s)=>()=>(s||a((s={exports:{}}).exports,s),s.exports),N=(a,s)=>{i(a);for(var c in s)l(a,c,{get:s[c],enumerable:!0})},k=(a,s,c)=>{if(s&&typeof s==\"object\"||typeof s==\"function\")for(let n of p(s))!m.call(a,n)&&n!==\"default\"&&l(a,n,{get:()=>s[n],enumerable:!(c=d(s,n))||c.enumerable});return a},g=a=>k(i(l(a!=null?r(h(a)):{},\"default\",a&&a.__esModule&&\"default\"in a?{get:()=>a.default,enumerable:!0}:{value:a,enumerable:!0})),a);var t=u((R,o)=>{o.exports=_jsx_runtime});var v={};N(v,{default:()=>w,frontmatter:()=>b});var e=g(t()),b={title:\"How to setup PostGIS with docker?\",date:\"2022-12-25\",tags:[\"postgis\",\"docker\"],draft:!1,summary:null};function S(a={}){let{wrapper:s}=a.components||{};return s?(0,e.jsx)(s,Object.assign({},a,{children:(0,e.jsx)(c,{})})):c();function c(){let n=Object.assign({h2:\"h2\",a:\"a\",span:\"span\",ul:\"ul\",li:\"li\",pre:\"pre\",code:\"code\",p:\"p\",h3:\"h3\",blockquote:\"blockquote\",br:\"br\"},a.components);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(n.h2,{id:\"environment\",children:[(0,e.jsx)(n.a,{href:\"#environment\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Environment\"]}),(0,e.jsxs)(n.ul,{children:[(0,e.jsx)(n.li,{children:\"Ubuntu 18.04\"}),(0,e.jsx)(n.li,{children:\"docker 20.10.7\"}),(0,e.jsx)(n.li,{children:\"docker-compose 1.24.1\"})]}),(0,e.jsxs)(n.h2,{id:\"with-docker\",children:[(0,e.jsx)(n.a,{href:\"#with-docker\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"With docker\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"docker run \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  --rm \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  --name some-postgis \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  -e \",(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"POSTGRES_PASSWORD\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"your-secret-password \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  -d postgis/postgis\n`})]})}),(0,e.jsx)(n.p,{children:\"You can connect to the database either directly on the running container.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"docker \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"exec\"}),` -ti some-postgis psql -U postgres\n`]})})}),(0,e.jsx)(n.p,{children:\"or you can define a docker network to link this database container.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`docker network create some-network\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Server container\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"docker run \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  --name some-postgis \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  --network some-network \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  -e \",(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"POSTGRES_PASSWORD\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"your-secret-password \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  -d postgis/postgis\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Client container\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"docker run \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  -ti \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  --rm \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  --network some-network \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  postgis/postgis \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  psql -h some-postgis -U postgres\n`})]})}),(0,e.jsxs)(n.p,{children:[\"If you want to connect to database with other GUI application, you can look up this container ip with \",(0,e.jsx)(n.code,{children:\"docker inspect\"}),\":\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"docker inspect some-postgis \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"grep\"}),` IPAddress\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# or inspect this network\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`docker network inspect some-network\n`})]})}),(0,e.jsxs)(n.h3,{id:\"persist-data-with-docker-volume\",children:[(0,e.jsx)(n.a,{href:\"#persist-data-with-docker-volume\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Persist data with docker volume\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"docker run \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  -d \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  --name some-postgis \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  --network some-network \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  -v \",(0,e.jsxs)(n.span,{className:\"token variable\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$(\"}),(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"pwd\"}),(0,e.jsx)(n.span,{className:\"token variable\",children:\")\"})]}),\"/pgdata:/var/lib/postgresql/data \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  -e \",(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"POSTGRES_PASSWORD\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"your-secret-password \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  postgis/postgis\n`})]})}),(0,e.jsx)(n.blockquote,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.code,{children:\"docker stop some-postgis\"}),\" -> Stop this container\",(0,e.jsx)(n.br,{}),(0,e.jsx)(n.code,{children:\"docker rm some-postgis\"}),\" -> Remove this container\",(0,e.jsx)(n.br,{}),(0,e.jsx)(n.code,{children:\"docker network rm some-network\"}),\" -> Remove this network\"]})}),(0,e.jsxs)(n.h2,{id:\"with-docker-compose\",children:[(0,e.jsx)(n.a,{href:\"#with-docker-compose\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"With docker compose\"]}),(0,e.jsx)(n.p,{children:\"You can setup postgis with other services.\"}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"docker-compose.yml\"})}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"version\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'3'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"services\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"postgis\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"image\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` postgis/postgis\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"container_name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` postgis_example\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"environment\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" POSTGRES_USER=$\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"POSTGRES_USER\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" POSTGRES_PASSWORD=$\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"POSTGRES_PASSWORD\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" POSTGRES_DB=$\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"POSTGRES_DB\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),` PGDATA=/var/lib/postgresql/data/pgdata\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"ports\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'${POSTGRES_PORT}:5432'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"volumes\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" $\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"PWD\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),\"/pgdata\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`/var/lib/postgresql/data\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"healthcheck\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"test\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'CMD-SHELL'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'pg_isready'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"interval\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` 10s\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"timeout\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` 5s\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"retries\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"5\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"volumes\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"pgdata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"Some secret or dev information is written in the \",(0,e.jsx)(n.code,{children:\".env\"}),\" file.\"]}),(0,e.jsx)(n.pre,{className:\"language-txt\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-txt\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`# .env\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`POSTGRES_USER=postgres\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`POSTGRES_PASSWORD=your-secret-password\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`POSTGRES_DB=postgres\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`POSTGRES_PORT=5432\n`})]})}),(0,e.jsx)(n.p,{children:\"Run this container is background with docker-compose.\"}),(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"code-highlight language-base\",children:(0,e.jsx)(n.span,{className:\"code-line\",children:`docker-compose up -d\n`})})}),(0,e.jsx)(n.p,{children:\"Connect to database\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"docker-compose \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"exec\"}),` postgis psql -U postgres\n`]})})}),(0,e.jsx)(n.blockquote,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.code,{children:\"docker-compose stop\"}),\" -> Stop services\",(0,e.jsx)(n.br,{}),(0,e.jsx)(n.code,{children:\"docker-compose down\"}),\" -> Stop and remove containers, networks, volumes and images created by \",(0,e.jsx)(n.code,{children:\"up\"}),\".\"]})}),(0,e.jsxs)(n.h2,{id:\"references\",children:[(0,e.jsx)(n.a,{href:\"#references\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"References\"]}),(0,e.jsxs)(n.ul,{children:[(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://registry.hub.docker.com/r/postgis/postgis/\",children:\"Docker Hub - postgis/postgis\"})}),(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://docs.docker.com/compose/environment-variables/\",children:\"Environment variables in Compose\"})})]})]})}}var w=S;return v;})();\n;return Component;","toc":[{"value":"Environment","url":"#environment","depth":2},{"value":"With docker","url":"#with-docker","depth":2},{"value":"Persist data with docker volume","url":"#persist-data-with-docker-volume","depth":3},{"value":"With docker compose","url":"#with-docker-compose","depth":2},{"value":"References","url":"#references","depth":2}],"frontMatter":{"readingTime":{"text":"3 min read","minutes":2.3,"time":138000,"words":460},"slug":"2022/how-to-setup-postgis-with-docker","fileName":"2022/how-to-setup-postgis-with-docker.md","title":"How to setup PostGIS with docker?","date":"2022-12-25T00:00:00.000Z","tags":["postgis","docker"],"draft":false,"summary":null}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.15,"time":9000,"words":30},"slug":["default"],"fileName":"default.md","name":"YuChun Tsao","avatar":"/static/images/avatar.png","occupation":null,"company":null,"email":"tsao84672776@gmail.com","twitter":null,"linkedin":null,"github":"https://github.com/YuChunTsao","date":null}],"prev":{"title":"Convert CSV to GeoJSON using GDAL","date":"2022-12-18T00:00:00.000Z","tags":["GDAL","CSV","GeoJSON"],"draft":false,"summary":null,"slug":"2022/convert-csv-to-geojson-using-gdal"},"next":{"title":"How to install osm2pgsql on ubuntu 18.04?","date":"2023-01-01T00:00:00.000Z","tags":["osm2pgsql"],"draft":false,"summary":null,"slug":"2023/how-to-install-osm2pgsql-on-ubuntu-18-04"}},"__N_SSG":true}