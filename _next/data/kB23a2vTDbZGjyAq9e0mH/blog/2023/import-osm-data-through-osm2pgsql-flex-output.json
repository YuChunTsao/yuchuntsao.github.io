{"pageProps":{"post":{"mdxSource":"var Component=(()=>{var p=Object.create;var l=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var i=a=>l(a,\"__esModule\",{value:!0});var N=(a,s)=>()=>(s||a((s={exports:{}}).exports,s),s.exports),k=(a,s)=>{i(a);for(var c in s)l(a,c,{get:s[c],enumerable:!0})},g=(a,s,c)=>{if(s&&typeof s==\"object\"||typeof s==\"function\")for(let e of h(s))!u.call(a,e)&&e!==\"default\"&&l(a,e,{get:()=>s[e],enumerable:!(c=d(s,e))||c.enumerable});return a},f=a=>g(i(l(a!=null?p(m(a)):{},\"default\",a&&a.__esModule&&\"default\"in a?{get:()=>a.default,enumerable:!0}:{value:a,enumerable:!0})),a);var r=N((j,o)=>{o.exports=_jsx_runtime});var q={};k(q,{default:()=>x,frontmatter:()=>w});var n=f(r()),w={title:\"Import OSM data through osm2pgsql flex output\",date:\"2023-02-05\",tags:[\"osm2pgsql\",\"OpenStreetMap\",\"PostGIS\"],draft:!1,summary:null};function y(a={}){let{wrapper:s}=a.components||{};return s?(0,n.jsx)(s,Object.assign({},a,{children:(0,n.jsx)(c,{})})):c();function c(){let e=Object.assign({h2:\"h2\",a:\"a\",span:\"span\",ul:\"ul\",li:\"li\",p:\"p\",blockquote:\"blockquote\",code:\"code\",pre:\"pre\",div:\"div\"},a.components),{Image:t}=e;return t||b(\"Image\",!0),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(e.h2,{id:\"environment\",children:[(0,n.jsx)(e.a,{href:\"#environment\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Environment\"]}),(0,n.jsxs)(e.ul,{children:[(0,n.jsx)(e.li,{children:\"PostGIS\"}),(0,n.jsx)(e.li,{children:\"osm2pgsql 1.7.2\"})]}),(0,n.jsxs)(e.h2,{id:\"osm2pgsql-flex-output\",children:[(0,n.jsx)(e.a,{href:\"#osm2pgsql-flex-output\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"osm2pgsql flex output\"]}),(0,n.jsx)(e.p,{children:\"The official introduction:\"}),(0,n.jsxs)(e.blockquote,{children:[(0,n.jsx)(e.p,{children:\"The flex output, as the name suggests, allows for a flexible configuration that tells osm2pgsql what OSM data to store in your database and exactly where and how. It is configured through a Lua file which\"}),(0,n.jsxs)(e.ul,{children:[(0,n.jsx)(e.li,{children:\"defines the structure of the output tables and\"}),(0,n.jsx)(e.li,{children:\"defines functions to map the OSM data to the database data format\"})]})]}),(0,n.jsxs)(e.p,{children:[\"In my case, I want to extract OSM highway data from \",(0,n.jsx)(e.code,{children:\"taipei.osm.bpf\"}),\" and import to PostGIS. In the Lua file, I defined a way table and columns, and get \",(0,n.jsx)(e.code,{children:\"Key:highway\"}),\" information in the \",(0,n.jsx)(e.code,{children:\"process_way\"}),\" function.\"]}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.code,{children:\"highways.lua\"})}),(0,n.jsx)(e.pre,{className:\"language-lua\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-lua\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"-- osm2pgsql projection default is EPSG:3857\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"local\"}),\" srid \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"4326\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"local\"}),\" tables \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"tables\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"highways \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" osm2pgsql\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"define_way_table\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'highways'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    column \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'name'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    type \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'text'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    column \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'name_en'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    type \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'text'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    column \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'type'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    type \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'text'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    column \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'geom'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    type \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'linestring'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    not_null \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"true\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    projection \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),` srid\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"function\"}),\" osm2pgsql\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"process_way\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"object\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"not\"}),\" object\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"tags\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"highway \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"then\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"end\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"local\"}),\" row \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        name \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" object\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"tags\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'name'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        name_en \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" object\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"tags\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'name:en'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        type \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" object\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"tags\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"highway\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        geom \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" object\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"as_linestring\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    tables\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"highways\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"insert\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"row\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"end\"}),`\n`]})]})}),(0,n.jsx)(e.p,{children:\"Execute the osm2pgsql command\"}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsx)(e.code,{className:\"code-highlight language-bash\",children:(0,n.jsx)(e.span,{className:\"code-line\",children:`osm2pgsql -d osm -O flex -S highways.lua ./data/taipei.osm.pbf\n`})})}),(0,n.jsxs)(e.h2,{id:\"view-in-qgis\",children:[(0,n.jsx)(e.a,{href:\"#view-in-qgis\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"View in QGIS\"]}),(0,n.jsx)(e.div,{children:(0,n.jsx)(t,{alt:\"view in qgis\",src:\"/static/images/2023/import-osm-data-through-osm2pgsql-flex-output/view_in_qgis.png\",width:\"922\",height:\"946\"})}),(0,n.jsxs)(e.h2,{id:\"references\",children:[(0,n.jsx)(e.a,{href:\"#references\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"References\"]}),(0,n.jsxs)(e.ul,{children:[(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://osm2pgsql.org/doc/manual.html#the-flex-output\",children:\"osm2pgsql manual - The Flex Output\"})}),(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://osm2pgsql.org/examples/\",children:\"osm2pgsql examples\"})}),(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://github.com/openstreetmap/osm2pgsql/tree/master/flex-config\",children:\"Flex Output Configuration\"})}),(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://wiki.openstreetmap.org/wiki/Key:highway\",children:\"OpenStreetMap - Key:highway\"})})]})]})}}var x=y;function b(a,s){throw new Error(\"Expected \"+(s?\"component\":\"object\")+\" `\"+a+\"` to be defined: you likely forgot to import, pass, or provide it.\")}return q;})();\n;return Component;","toc":[{"value":"Environment","url":"#environment","depth":2},{"value":"osm2pgsql flex output","url":"#osm2pgsql-flex-output","depth":2},{"value":"View in QGIS","url":"#view-in-qgis","depth":2},{"value":"References","url":"#references","depth":2}],"frontMatter":{"readingTime":{"text":"2 min read","minutes":1.9,"time":114000,"words":380},"slug":"2023/import-osm-data-through-osm2pgsql-flex-output","fileName":"2023/import-osm-data-through-osm2pgsql-flex-output.md","title":"Import OSM data through osm2pgsql flex output","date":"2023-02-05T00:00:00.000Z","tags":["osm2pgsql","OpenStreetMap","PostGIS"],"draft":false,"summary":null}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.15,"time":9000,"words":30},"slug":["default"],"fileName":"default.md","name":"YuChun Tsao","avatar":"/static/images/avatar.png","occupation":null,"company":null,"email":"tsao84672776@gmail.com","twitter":null,"linkedin":null,"github":"https://github.com/YuChunTsao","date":null}],"prev":{"title":"How to install and setup PostGIS on Ubuntu 22.04?","date":"2023-01-29T00:00:00.000Z","tags":["PostGIS"],"draft":false,"summary":null,"slug":"2023/how-to-install-and-setup-postgis-on-ubuntu-22-04"},"next":{"title":"Create vector tiles with tippecanoe","date":"2023-02-12T00:00:00.000Z","tags":["OpenStreetMap","Vector Tiles","Tippecanoe"],"draft":false,"summary":null,"slug":"2023/create-vector-tiles-with-tippecanoe"}},"__N_SSG":true}